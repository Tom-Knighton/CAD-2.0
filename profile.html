<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<title>DOJRP CAD / MDT</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="Modern new CAD for DOJRP">
	<meta name="author" content="Tom K. Civ-305 for DOJRP">    
	<link href="https://fonts.googleapis.com/css?family=Lato:300,400,300italic,400italic" rel="stylesheet" type="text/css">
	<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css"> 
	<!-- Global CSS -->
	<link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css">   
	<!-- Plugins CSS -->
	<link rel="stylesheet" href="assets/plugins/font-awesome/css/font-awesome.css">

	<!-- Theme CSS -->  
	<link id="theme-style" rel="stylesheet" href="assets/css/styles.css">
	<link id="theme-main" rel="stylesheet" href="assets/css/main.css">
	<link type="text/css" rel="stylesheet" href="assets/css/materialize.css"  media="screen,projection" id="theme-material"/>
	
</head>

<body onLoad="setup()">
	<!--Profile header, nav bar, staff button, patrol button-->
	<div style="margin-top: 10px; margin-left: 10px; margin-right: 10px">
			<div class="wrap-login100" style="width: 100%; min-height: 100px">
			
				<button style="max-width: 30px; max-height: 30px; float: left; margin-top: -25px"><img src="assets/images/gear.png" alt="profile settings" style="max-width: 40px; max-height: 40px" ></button>
				<h3 style="color: black; float: left; margin-top: -30px; display: inline-block; margin-left: 40px; font-size: 40px" id="headerName"></h3>
				
				<div class="wrap-login100-form-btn" style="min-width: 10%; max-width: 20%; margin-top: -30px; float:right">
					<div class="login100-form-bgbtn"></div>
						<button class="login100-form-btn" onClick="selectServer()">
							Patrol
						</button>
				</div>
				<div class="wrap-login100-form-btn" style="min-width: 15%; max-width: 20%; margin-top: -30px; float:right; margin-right: 5px; visibility: visible" id="staffContainer">
					<div class="login100-form-bgbtn"></div>
						<button class="login100-form-btn" onClick="staff()" style="background-color: darkred" id="staffButton">
							Staff
						</button>
				</div>
			</div>
	</div>
	
	<!-- Updates-->
	<div style="margin-top: 10px; margin-left: 10px; margin-right: 10px">
			<div class="wrap-login100" style="width: 100%; min-height: 100px; background-color: #1d1d1d">	
				<h5 align="center" style="font-size: 30px; margin-top: -50px; color: white">Updates / Announcements: (Latest Update 29/04/18) </h5>
         		<p class="grey-text" align="center" id="announcementText"></p>
			</div>
	</div>
	
	<!-- Suggestions, bug reports and stats -->
	<div class="container-login100-form-btn">
		<div style="margin-top: 10px; margin-left: 10px; margin-right: 10px; display: inline-block; max-width: 30%; min-width: 350px; width: 30%">
			<div class="wrap-login100" style="min-height: 300px; background-color: #1d1d1d; width: 100%">	
				<h5 align="center" style="font-size: 30px; margin-top: -50px; color: white">CAD / MDT Suggestions: </h5>
         		<textarea style="width: 100%; min-height: 200px; max-width: 100%; margin-top: 10px; padding: 10px; background-color: white; border-radius: 20px; min-width: 100%" placeholder="Suggestion goes here..."></textarea>
				<div class="wrap-login100-form-btn" style="margin-top: 10px">
				<div class="login100-form-bgbtn"></div>
					<button class="login100-form-btn" onClick="staff()" style="background-color: dodgerblue" >
						Submit
					</button>
				</div>
			</div>
			
		</div>
		<div style="margin-top: 10px; margin-left: 10px; margin-right: 10px; display: inline-block; max-width: 30%; min-width: 350px; width: 30%">
				<div class="wrap-login100" style="min-height: 300px; background-color: #1d1d1d; width: 100%">	
					<h5 align="center" style="font-size: 30px; margin-top: -50px; color: white">CAD / MDT Bug Reports: </h5>
					<textarea style="width: 100%; min-height: 200px; max-width: 100%; margin-top: 10px; padding: 10px; background-color: white; border-radius: 20px; min-width: 100%" placeholder="Bug report goes here..."></textarea>
					<div class="wrap-login100-form-btn" style="margin-top: 10px">
					<div class="login100-form-bgbtn"></div>
						<button class="login100-form-btn" onClick="staff()" style="background-color: dodgerblue; margin-top: " >
							Submit
						</button>
					</div>
				</div>

		</div>
		<div style="margin-top: 10px; margin-left: 10px; margin-right: 10px; display: inline-block; max-width: 30%; min-width: 350px; width: 30%">
				<div class="wrap-login100" style="min-height: 363px; background-color: #1d1d1d; width: 100%">	
					<h5 align="center" style="font-size: 30px; margin-top: -50px; color: white">Community Wide Stats: </h5>
					<h6 align="center" style="font-size: 15px; color: white">For the month of April: </h6>
					<p style="min-width: 100%; margin-top: 20%; color: white; font-size: 20px" align="center">Tickets Written: </p>
					<p style="min-width: 100%; margin-top: 5%; color: white; font-size: 20px" align="center">Arrests Filed: </p>
					<p style="min-width: 100%; margin-top: 5%; color: white; font-size: 20px" align="center">Warnings Given: </p>
				</div>

		</div>
		
	</div>
	
	<div id="selectServer" class="modal" style="height: 130px">
		<div class="modal-content">
			<h2 align="center">Select Server</h2>
			<select id="serverChoice" style="width: 100%; text-align: center; margin-top: 20px">
				<option value="0" selected="selected" disabled>Choose Server</option>
				<option value="server1">Server 1</option>
				<option value="server2">Server 2</option>
				<option value="server3">Server 3</option>
				<option value="server4">Server 4</option>
			</select>
		</div>
		 
	</div>
	
	<div id="selectDept" class="modal" style="height: 545px; width: 1000px; background-color: white">
		<div class="modal-content" style="align-content: center; text-align: center">
			<h2 align="center">Select Department</h2>
			<div>
				<button onClick="selectDept('coms')"><img src="assets/images/comms.png" alt="comms" style="width: 200px; height: 200px; float: left; margin-right: 50px"></button>
				<button onClick="selectDept('bcso')"><img src="assets/images/bcso.png" alt="BCSO" style="width: 200px; height: 200px; float: left; margin-right: 50px"></button>
				<button onClick="selectDept('sahp')"><img src="assets/images/sahp.png" alt="SAHP" style="width: 200px; height: 200px; float: left; margin-right: 50px"></button>
			</div>
			<div>
				<button onClick="selectDept('lspd')"><img src="assets/images/lspd.png" alt="LSPD" style="width: 200px; height: 200px; float: left; margin-right: 50px; margin-top: 50px"></button>
				<button onClick="selectDept('fire')"><img src="assets/images/lsfd.png" alt="LSFD" style="width: 200px; height: 200px; float: left; margin-right: 50px; margin-top: 50px"></button>
				<button onClick="selectDept('civ')"><img src="assets/images/civ.png" alt="Civillian" style="width: 200px; height: 200px; float: left; margin-right: 50px; margin-top: 50px"></button>
			</div>
			
		</div>
		 
	</div>
	
	<div id="selectUnit" class="modal" style="height: 195px;">
		<div class="modal-content" style="align-content: center; text-align: center">
			<h2 align="center">Set Identifier</h2>
			<input class="input100" type="text" id="unitSet" style="background-color: wheat; border-radius: 20px; text-align: center">
			<span class="focus-input100"></span>
			<div class="container-login100-form-btn">
				<div class="wrap-login100-form-btn">
					<div class="login100-form-bgbtn"></div>
						<button class="login100-form-btn" onClick="patrol()">
							Patrol
						</button>
					</div>
			</div>
		</div>
		 
	</div>
	
	
	
	<!--Java Script:-->
	<!--===============================================================================================-->
	<script src="assets/vendor/jquery/jquery-3.2.1.min.js"></script>
	<!--===============================================================================================-->
	<script src="assets/vendor/animsition/js/animsition.min.js"></script>
	<!--===============================================================================================-->
	<script src="assets/vendor/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="assets/js/materialize.min.js"></script>
	<!--===============================================================================================-->
	<script src="assets/js/main.js"></script>
	<!--Init firebase-->
	<script src="https://www.gstatic.com/firebasejs/4.10.0/firebase.js"></script>

	<script>
		window.location = "#";
		var currentUser = {};
		var lspd = false;
		var civ = false;
		var bcso = false;
		var fire = false;
		var coms = false;
		var sahp = false;
		
		var selectedDept = "";
		var selectedServer = "";
		var selectedIdentifier = "";
		
		
		$(document).ready(function(){
    		$('.modal').modal();

		});
		
		function setup() {
			
			var config = {
				apiKey: "AIzaSyD6N15xy8b5ZaFmbrvuzuRIUW3AX7Czifg",
				authDomain: "dojrp-cad.firebaseapp.com",
				databaseURL: "https://dojrp-cad.firebaseio.com",
				projectId: "dojrp-cad",
				storageBucket: "",
				messagingSenderId: "533785462743"
			  };
			firebase.initializeApp(config);
			
			firebase.auth().onAuthStateChanged(function(user) {
				if (user) {
					currentUser = user;
					var uid = user.uid;
					
					//global data
					firebase.database().ref().once('value', function(snap) {
						document.getElementById('announcementText').innerHTML = snap.child('latestAnnouncement').val();
					});					
					//user data
					var userRef = firebase.database().ref('users/'+uid);
					userRef.once('value', function(snapshot) {
						if (snapshot.child('queued').val() == true) {
							window.location = "queue";
						}
						
						document.getElementById('headerName').innerHTML = snapshot.child('dojname').val();
						lspd = snapshot.child('lspd').val();
						civ = snapshot.child('civ').val();
						bcso = snapshot.child('bcso').val();
						fire = snapshot.child('fire').val();
						coms = snapshot.child('comms').val();
						sahp = snapshot.child('sahp').val();
					});
				}
				else {
					window.location = "index";
				}
			});
		}  
		
		function selectServer() {
			$('#selectServer').modal('open');
		}
		
		function lspd() {
			
		}
		
		function selectDept(dept) {
			if (dept == "lspd") {
				if (lspd) {
					selectedDept = "lspd"
					$("#selectUnit").modal('open');
					$("#selectDept").modal('close');
				}
				else {
					alert('You do not have access to this department');
				}
			}
			if (dept == "bcso") {
				if (bcso) {
					selectedDept = "bcso"
					$("#selectUnit").modal('open');
					$("#selectDept").modal('close');
				}
				else {
					alert('You do not have access to this department');
				}
			}
			if (dept == "sahp") {
				if (sahp) {
					selectedDept = "sahp"
					$("#selectUnit").modal('open');
					$("#selectDept").modal('close');
				}
				else {
					alert('You do not have access to this department');
				}
			}
			if (dept == "coms") {
				if (coms) {
					selectedDept = "comms"
					$("#selectUnit").modal('open');
					$("#selectDept").modal('close');
				}
				else {
					alert('You do not have access to this department');
				}
			}
			if (dept == "fire") {
				if (fire) {
					selectedDept = "fire"
					$("#selectUnit").modal('open');
					$("#selectDept").modal('close');
				}
				else {
					alert('You do not have access to this department');
				}
			}
			if (dept == "civ") {
				if (civ) {
					selectedDept = "civ"
					$("#selectUnit").modal('close');
					$("#selectDept").modal('open');
				}
				else {
					alert('You do not have access to this department');
				}
			}
		}
		function updateServerStats(dept, identifier) {
			console.log("hello");
		}
		function patrol() {
			var unit = document.getElementById('unitSet').value;
			if (IsNullOrWhiteSpace(unit)) {
				alert('Please enter a valid indentifier');
			}
			else {
				self.updateServerStats(selectedDept, selectedIdentifier);
					
					
				firebase.database().ref('users/'+currentUser.uid).update({
					lastUnit: selectedIdentifier,
					lastServer: selectedServer,
					lastDept: selectedDept
					
				}).then(function(){
					console.log('hi');
					if (selectedDept == "lspd" || selectedDept == "sahp" || selectedDept == "bcso") {
						window.location = "leo";
					}
					else if (selectedDept == "civ") {
						window.location = "civ";
					}
					else if (selectedDept == "coms") {
						window.location = "mdt";
					}
					else if (selectedDept == "fire") {
						window.location = "fire";
					}
				});
					
				}
			
		}
		
		$("#serverChoice").change(function() {
			selectedServer = $(this).val();
			$("#selectDept").modal('open');
			$('#selectServer').modal('close');

		});
		
		function IsNullOrWhiteSpace( value) {
    		if (value== null) return true;
    		return value.replace(/\s/g, '').length == 0;
		}
	</script>
	

</body>
</html>
